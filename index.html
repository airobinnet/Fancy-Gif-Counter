<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Canvas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href='https://fonts.googleapis.com/css?family=Autour One' rel='stylesheet'>
    <script src="gif.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .gradient-bg {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .content-wrapper {
            background-image: linear-gradient(to bottom right, #95429A, #E6BCDD);
            padding: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rounded-rectangle {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            flex-direction: row;
            width: 250px;
        }

        .icon {
            font-size: 32px;
            margin-right: 20px;
            cursor: pointer;
            color: var(--icon-color);
            background-color: var(--icon-bg-color);
            border-radius: 50%;
            padding: 8px;
            width: 48px;
            text-align: center;
            height: 48px;
            vertical-align: middle;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .number {
            font-size: 24px;
            margin-bottom: 5px;
            font-family: 'Autour One';
        }

        .text {
            font-size: 14px;
            font-family: 'Autour One';
        }

        .add-remove-icons {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .add-remove-icons i {
            font-size: 24px;
            margin: 0 10px;
            cursor: pointer;
        }

        .icon-selector {
            display: none;
            flex-wrap: wrap;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .icon-selector i {
            font-size: 24px;
            margin: 5px;
            cursor: pointer;
        }

        .icon-selector.visible {
            display: flex;
        }

        .colorpickers input {
            margin: 0 5px;
        }
        .number-text-wrapper {
            display: flex;
            flex-direction: column;
            align-items: left;
        }
    </style>
</head>
<body>
    <div class="gradient-bg">
        <div class="content-wrapper">
            <div id="canvas">
                <!-- Rectangles will be added here -->
            </div>
        </div>
        <div class="add-remove-icons">
            <i class="fas fa-plus-circle" onclick="addRectangle()"></i>
            <i class="fas fa-minus-circle" onclick="removeRectangle()"></i>
        </div>
    <br>
    <div class="colorpickers">
        <input type="color" id="color1" value="#95429A" onchange="updateGradient()">
        <input type="color" id="color2" value="#E6BCDD" onchange="updateGradient()">
        <input type="color" id="color3" value="#E6BCDD" onchange="updateIconBackgroundColor()">
    </div>
    <br>
    <button id="generate-gif-btn">Generate GIF</button>
    <img id="gif-preview" style="display: none;" />
    </div>

    <script>
        document.getElementById('generate-gif-btn').addEventListener('click', generateGif);

        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        function generateGif() {
            const contentWrapper = document.querySelector('.content-wrapper');

            html2canvas(contentWrapper).then((canvas) => {
                const ctx = canvas.getContext('2d');

                const gif = new GIF({
                workerScript: './gif.worker.js',
                workers: 2,
                quality: 10,
                width: canvas.width,
                height: canvas.height,
                repeat: -1,
                });

                gif.on('finished', function (blob) {
                const gifPreview = document.getElementById('gif-preview');
                gifPreview.src = URL.createObjectURL(blob);
                gifPreview.style.display = 'block';
                });

                let start = Date.now();
                let duration = 2000;

                function drawFrame(progress) {
                    const easedProgress = easeOutCubic(progress); // Apply easing function

                    const numbers = document.querySelectorAll('.number');
                    numbers.forEach((numberElement) => {
                        const numberText = numberElement.textContent;
                        const regex = /([\D]*)(\d+)([\D]*)/; // Regular expression to match number and symbol/text
                        const match = numberText.match(regex);

                        const symbolBefore = match[1];
                        const targetNumber = parseInt(match[2]);
                        const symbolAfter = match[3];
                        const currentNumber = Math.floor(targetNumber * easedProgress);

                        const numberRect = numberElement.getBoundingClientRect();
                        const contentWrapperRect = contentWrapper.getBoundingClientRect();
                        const x = numberRect.left;
                        const y = numberRect.top;
                        // add white background
                        ctx.fillStyle = 'white';
                        ctx.fillRect(x, y, numberRect.width + 20, numberRect.height);

                        ctx.font = '24px Autour One';
                        ctx.fillStyle = 'black';
                        ctx.fillText(symbolBefore + currentNumber + symbolAfter, x, y + 24);
                    });
                    gif.addFrame(ctx, { delay: 20, copy: true });
                    }

                function animate() {
                let timePassed = Date.now() - start;
                let progress = timePassed / duration;

                if (progress > 1) {
                    progress = 1;
                }

                drawFrame(progress);

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    gif.addFrame(ctx, { delay: 3000, copy: true });
                    gif.render();
                }
                }

                animate();
            });
        }

        const canvas = document.getElementById('canvas');
        updateIconBackgroundColor();

        function updateGradient() {
            const color1 = document.getElementById('color1').value;
            const color2 = document.getElementById('color2').value;
            document.querySelector('.content-wrapper').style.backgroundImage = `linear-gradient(to bottom right, ${color1}, ${color2})`;
            document.documentElement.style.setProperty('--color2', color2);
        }

        function updateIconBackgroundColor() {
            const color3 = document.getElementById('color3').value;
            const rgbaColor = hexToRGBA(color3, 0.25);
            document.documentElement.style.setProperty('--icon-color', color3);
            document.documentElement.style.setProperty('--icon-bg-color', rgbaColor);
        }

        function hexToRGBA(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        document.documentElement.style.setProperty('--color2', document.getElementById('color3').value);

        function createIconSelector() {
            const icons = [
                'fas fa-chart-line',
                'fas fa-dollar-sign',
                'fas fa-users',
                'fas fa-globe',
                'fas fa-heart',
            ];

            const iconSelector = document.createElement('div');
            iconSelector.className = 'icon-selector';

            icons.forEach(iconClass => {
                const icon = document.createElement('i');
                icon.className = iconClass;
                icon.onclick = function() {
                    iconSelector.parentElement.querySelector('.icon').className = `icon ${iconClass}`;
                    iconSelector.classList.remove('visible');
                };
                iconSelector.appendChild(icon);
            });

            return iconSelector;
        }

        function createRectangle(icon, number, text) {
            const rectangle = document.createElement('div');
            rectangle.className = 'rounded-rectangle';

            const iconElement = document.createElement('i');
            iconElement.className = `icon ${icon}`;
            iconElement.onclick = function() {
                const iconSelector = rectangle.querySelector('.icon-selector');
                iconSelector.classList.toggle('visible');
            };

            const numberElement = document.createElement('span');
            numberElement.className = 'number';
            numberElement.contentEditable = 'true';
            numberElement.textContent = number;

            const textElement = document.createElement('span');
            textElement.className = 'text';
            textElement.contentEditable = 'true';
            textElement.textContent = text;

            const numberTextWrapper = document.createElement('div');
            numberTextWrapper.className = 'number-text-wrapper';

            numberTextWrapper.appendChild(numberElement);
            numberTextWrapper.appendChild(textElement);

            const iconSelector = createIconSelector();

            rectangle.appendChild(iconElement);
            rectangle.appendChild(numberTextWrapper);
            rectangle.appendChild(iconSelector);

            return rectangle;
        }

        function addRectangle() {
            const rectangle = createRectangle('fas fa-chart-line', '1000', 'Website Visits');
            canvas.appendChild(rectangle);
        }

        function removeRectangle() {
            if (canvas.lastChild) {
                canvas.removeChild(canvas.lastChild);
            }
        }

        // Add the first rectangle on page load
        addRectangle();
    </script>
</body>
</html>
